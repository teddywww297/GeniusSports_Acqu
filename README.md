# GeniusSports.Acqu

Genius Sports è³‡æ–™æ¡é›†å¾®æœå‹™

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

```
GeniusSports.Acqu/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ GS.Acqu.Domain/           # é ˜åŸŸå±¤ (å¯¦é«”/åˆ—èˆ‰/ä»‹é¢)
â”‚   â”‚   â”œâ”€â”€ Entities/             # å¯¦é«”é¡åˆ¥
â”‚   â”‚   â”œâ”€â”€ Enums/                # åˆ—èˆ‰å®šç¾©
â”‚   â”‚   â”œâ”€â”€ Interfaces/           # å„²å­˜åº«ä»‹é¢
â”‚   â”‚   â””â”€â”€ Extensions/           # æ“´å……æ–¹æ³•
â”‚   â”‚
â”‚   â”œâ”€â”€ GS.Acqu.Application/      # æ‡‰ç”¨å±¤ (ç”¨ä¾‹/æ¥­å‹™é‚è¼¯)
â”‚   â”‚   â”œâ”€â”€ DTOs/                 # è³‡æ–™å‚³è¼¸ç‰©ä»¶
â”‚   â”‚   â”œâ”€â”€ Interfaces/           # æ‡‰ç”¨æœå‹™ä»‹é¢
â”‚   â”‚   â””â”€â”€ UseCases/             # ç”¨ä¾‹è™•ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ GS.Acqu.Infrastructure/   # åŸºç¤è¨­æ–½å±¤ (å¯¦ä½œ)
â”‚   â”‚   â”œâ”€â”€ Data/                 # è³‡æ–™åº«è¨­å®š
â”‚   â”‚   â”œâ”€â”€ Repositories/         # å„²å­˜åº«å¯¦ä½œ
â”‚   â”‚   â”œâ”€â”€ Services/             # æœå‹™å¯¦ä½œ
â”‚   â”‚   â””â”€â”€ Utilities/            # å·¥å…·é¡åˆ¥
â”‚   â”‚
â”‚   â”œâ”€â”€ GS.Acqu.Worker/           # gRPC æœå‹™
â”‚   â”‚   â”œâ”€â”€ Protos/               # Protocol Buffers å®šç¾©
â”‚   â”‚   â”œâ”€â”€ Services/             # gRPC æœå‹™å¯¦ä½œ
â”‚   â”‚   â””â”€â”€ Worker.cs             # èƒŒæ™¯æœå‹™
â”‚   â”‚
â”‚   â””â”€â”€ GS.Acqu.Api/              # Web API
â”‚       â””â”€â”€ Controllers/          # API æ§åˆ¶å™¨
â”‚
â”œâ”€â”€ sql/                          # SQL è…³æœ¬
â”‚   â””â”€â”€ GS_Acqu_Database_Setup.sql
â”‚
â””â”€â”€ GeniusSports.Acqu.sln
```

---

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

æœ¬å°ˆæ¡ˆæ¡ç”¨ **Clean Architecture (ä¹¾æ·¨æ¶æ§‹)** è¨­è¨ˆæ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å±•ç¤ºå±¤ (Presentation)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   GS.Acqu.Worker    â”‚    â”‚       GS.Acqu.Api           â”‚ â”‚
â”‚  â”‚      (gRPC)         â”‚    â”‚      (REST API)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚       åŸºç¤è¨­æ–½å±¤ (Infrastructure)             â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚             â””â”€â–ºâ”‚    GS.Acqu.Infrastructure        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                â”‚  â€¢ Repositories (DB å­˜å–)        â”‚         â”‚
â”‚                â”‚  â€¢ Services (å°é»/å¿«å–/éšŠåˆ—)      â”‚         â”‚
â”‚                â”‚  â€¢ Utilities (Hash/æ­£è¦åŒ–)        â”‚         â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æ‡‰ç”¨å±¤ (Application)                    â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                â”‚     GS.Acqu.Application          â”‚         â”‚
â”‚                â”‚  â€¢ UseCases (è¨Šæ¯è™•ç†å™¨)         â”‚          â”‚
â”‚                â”‚  â€¢ Interfaces (æœå‹™ä»‹é¢)         â”‚          â”‚
â”‚                â”‚  â€¢ DTOs                          â”‚         â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      é ˜åŸŸå±¤ (Domain)                         â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                â”‚       GS.Acqu.Domain             â”‚         â”‚
â”‚                â”‚  â€¢ Entities (å¯¦é«”)               â”‚          â”‚
â”‚                â”‚  â€¢ Enums (åˆ—èˆ‰)                  â”‚          â”‚
â”‚                â”‚  â€¢ Interfaces (å„²å­˜åº«ä»‹é¢)       â”‚          â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| å±¤ç´š | å°ˆæ¡ˆ | è·è²¬ |
|------|------|------|
| Domain | `GS.Acqu.Domain` | å¯¦é«”ã€åˆ—èˆ‰ã€å„²å­˜åº«ä»‹é¢ |
| Application | `GS.Acqu.Application` | ç”¨ä¾‹ã€æ¥­å‹™é‚è¼¯ã€DTOã€æ‡‰ç”¨æœå‹™ä»‹é¢ |
| Infrastructure | `GS.Acqu.Infrastructure` | è³‡æ–™åº«å­˜å–ã€å¿«å–æœå‹™ã€æ‰¹æ¬¡è™•ç† |
| Presentation | `GS.Acqu.Api` / `Worker` | REST APIã€gRPC æœå‹™ |

---

## ğŸ”„ è³‡æ–™æµç¨‹

```
Genius Sports (å¤–éƒ¨æ•¸æ“šæº)
         â”‚
         â–¼ gRPC (HTTP/2)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚         AcquGrpcService             â”‚
   â”‚  â€¢ PushMatchInfo()                  â”‚
   â”‚  â€¢ PushMarketOdds()                 â”‚
   â”‚  â€¢ StreamMarketOdds() (ä¸²æµ)        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Proto â†’ Domain è½‰æ›
                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚         Message Handlers            â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚  â”‚MatchInfo  â”‚MarketOdds â”‚Result  â”‚ â”‚
   â”‚  â”‚ Handler   â”‚ Handler   â”‚Handler â”‚ â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚
   â”‚        â”‚           â”‚          â”‚     â”‚
   â”‚        â–¼           â–¼          â–¼     â”‚
   â”‚   MatcherService  Cache+Queue  DB   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚           â”‚          â”‚
            â–¼           â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚            SQL Server               â”‚
   â”‚  tblLeague / tblTeam / tblGameData  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

| æ¨¡çµ„ | æª”æ¡ˆ | åŠŸèƒ½èªªæ˜ |
|------|------|----------|
| **gRPC æœå‹™** | `AcquGrpcService.cs` | æ¥æ”¶å¤–éƒ¨æ¨é€ï¼Œæ”¯æ´å–®ç­†/ä¸²æµ |
| **è³½äº‹è™•ç†** | `MatchInfoHandler.cs` | è³½äº‹å°é» â†’ è¯è³½/çƒéšŠåŒ¹é… â†’ å­˜åº« |
| **ç›¤å£è™•ç†** | `MarketOddsHandler.cs` | å¿«å–æ¯”å° â†’ è®Šæ›´æª¢æ¸¬ â†’ æ‰¹æ¬¡éšŠåˆ— |
| **çµæœè™•ç†** | `MatchResultHandler.cs` | æ¯”è³½çµæœæ›´æ–° |
| **å°é»æœå‹™** | `MatcherService.cs` | è¯è³½/çƒéšŠåç¨±åŒ¹é… + è‡ªå‹•æ–°å¢ |
| **æ‰¹æ¬¡éšŠåˆ—** | `MarketQueueService.cs` | TVP + SP é«˜æ•ˆå¯«å…¥ |

---

## âš¡ é«˜æ•ˆèƒ½è³ ç‡å¯«å…¥æ¶æ§‹

æœ¬å°ˆæ¡ˆé‡å°é«˜é »ç‡è³ ç‡å¯«å…¥å ´æ™¯ï¼Œå¯¦ä½œäº†èˆ‡ç¾æœ‰ç³»çµ±ä¸€è‡´çš„é«˜æ•ˆèƒ½è™•ç†æ¶æ§‹ã€‚

### æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è³ ç‡å¯«å…¥è™•ç†æ¶æ§‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  æ•¸æ“šä¾†æº   â”‚     â”‚  æ•¸æ“šè½‰æ›   â”‚     â”‚  å¿«å–æ¯”å°   â”‚           â”‚
â”‚  â”‚   (gRPC)    â”‚ â”€â”€â–º â”‚ (Protoâ†’DTO)â”‚ â”€â”€â–º â”‚ (Memory)    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                  â”‚                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                    â–¼                             â–¼               â–¼ â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚            â”‚  æ–°å¢ç›¤å£    â”‚            â”‚  æ›´æ–°ç›¤å£    â”‚   â”‚ é—œé–‰ç›¤å£ â”‚â”‚
â”‚            â”‚  (Queue)     â”‚            â”‚  (Queue)     â”‚   â”‚ (SQL)    â”‚â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜â”‚
â”‚                   â”‚                           â”‚                â”‚     â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚     â”‚
â”‚                               â–¼                                â–¼     â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                       â”‚ æ‰¹æ¬¡éšŠåˆ—    â”‚              â”‚   SQLéšŠåˆ—    â”‚ â”‚
â”‚                       â”‚ (TVP 300ç­†) â”‚              â”‚              â”‚ â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                             â”‚         â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                         â–¼                            â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                                â”‚  èƒŒæ™¯åŸ·è¡Œç·’  â”‚                      â”‚
â”‚                                â”‚  (5ms è¼ªè©¢)  â”‚                      â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                       â–¼                              â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                                â”‚ SQL Server   â”‚                      â”‚
â”‚                                â”‚ (TVP + SP)   â”‚                      â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

| åŸå‰‡ | èªªæ˜ | æ•ˆç›Š |
|------|------|------|
| **å¿«å–å„ªå…ˆ** | ä½¿ç”¨ ConcurrentDictionary å­˜æ”¾ç›¤å£è³‡æ–™ | æ¸›å°‘ DB æŸ¥è©¢ |
| **è®Šæ›´æª¢æ¸¬** | æ¯”å°æ–°èˆŠè³‡æ–™ï¼Œåƒ…æ›´æ–°æœ‰è®Šæ›´çš„ | æ¸›å°‘ç„¡æ•ˆå¯«å…¥ |
| **æ‰¹æ¬¡è™•ç†** | ç´¯ç© 300 ç­†å¾Œä¸€æ¬¡å¯«å…¥ | æå‡ååé‡ |
| **éåŒæ­¥åŸ·è¡Œ** | èƒŒæ™¯åŸ·è¡Œç·’è™•ç†å¯«å…¥ | ä¸é˜»å¡ä¸»æµç¨‹ |
| **å”¯ä¸€è­˜åˆ¥** | BKDR Hash ç”¢ç”Ÿå”¯ä¸€ ID | å¿«é€ŸæŸ¥æ‰¾èˆ‡é˜²é‡è¤‡ |

### æ•ˆèƒ½æŒ‡æ¨™

| è™•ç†æ–¹å¼ | 1000 ç­†è€—æ™‚ | TPS | å‚™è¨» |
|----------|-------------|-----|------|
| é€ç­† UPDATE | ~5000 ms | 200 | æ¯ç­†ç¨ç«‹é€£ç·š |
| æ‰¹æ¬¡ SQL | ~800 ms | 1250 | æ‹¼æ¥ 300 ç­† |
| **TVP + SP** | **~150 ms** | **6667** | **æœ¬æ¶æ§‹æ¡ç”¨** |

### é—œéµå…ƒä»¶

| å…ƒä»¶ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| Hash å·¥å…· | `Infrastructure/Utilities/HashHelper.cs` | BKDR Hash å”¯ä¸€ ID ç”Ÿæˆ |
| åç¨±æ­£è¦åŒ– | `Infrastructure/Utilities/NameNormalizer.cs` | çµ±ä¸€åç¨±æ ¼å¼ |
| å¿«å–å¯¦é«” | `Domain/Entities/MarketDetailCache.cs` | ç›¤å£å¿«å–ç‰©ä»¶ |
| å¿«å–æœå‹™ | `Infrastructure/Services/MarketCacheService.cs` | ConcurrentDictionary å¯¦ä½œ |
| éšŠåˆ—æœå‹™ | `Infrastructure/Services/MarketQueueService.cs` | TVP æ‰¹æ¬¡éšŠåˆ—è™•ç† |
| ç›¤å£è™•ç† | `Application/UseCases/MarketOddsHandler.cs` | æ•´åˆå¿«å–èˆ‡è®Šæ›´æª¢æ¸¬ |

---

## ğŸ¯ è³½äº‹å°é»æ©Ÿåˆ¶

### å°é»æµç¨‹

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ”¶åˆ°è³½äº‹è³‡è¨Š   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 1. å°é»è¯è³½ (MatcherService) â”‚
              â”‚    ä¸»åç¨± â†’ ä¸­æ–‡å â†’ è‹±æ–‡å  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 2. å°é»ä¸»éšŠ (MatcherService) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 3. å°é»å®¢éšŠ (MatcherService) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4. æ–°å¢/æ›´æ–°è³½äº‹ (Repository)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å°é»ç‰¹é»

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| **å¤šåç¨±åŒ¹é…** | ä¾åºå˜—è©¦ï¼šä¸»åç¨± â†’ ä¸­æ–‡å â†’ è‹±æ–‡å |
| **åç¨±æ­£è¦åŒ–** | è½‰å°å¯«ã€ç§»é™¤ç©ºç™½èˆ‡æ§åˆ¶å­—å…ƒ |
| **åˆ¥åæ”¯æ´** | è¼‰å…¥ `tblSubLeague` / `tblSubTeam` åˆ¥åè¡¨ |
| **è‡ªå‹•æ–°å¢** | å°é»å¤±æ•—æ™‚å¯è‡ªå‹• INSERT æ–°è¨˜éŒ„ |
| **åŸå­æ€§å¿«å–åˆ·æ–°** | å…ˆå»ºæ–°å¿«å– â†’ å†æ›¿æ›ï¼Œé¿å…ä¸¦ç™¼å•é¡Œ |

### è³‡æ–™ä¾†æº

| è³‡æ–™è¡¨ | æ¬„ä½ | èªªæ˜ |
|--------|------|------|
| `tblLeague` | `MapName_GS` | GS è¯è³½å°é»æ¬„ä½ |
| `tblTeam` | `TeamName_GS` | GS çƒéšŠå°é»æ¬„ä½ |
| `tblSubLeague` | `MapName` | è¯è³½åˆ¥å (MapSite='GS') |
| `tblSubTeam` | `MapName` | çƒéšŠåˆ¥å (MapSite='GS') |

---

## ğŸŒ gRPC æœå‹™

### Proto å®šç¾©

```protobuf
service AcquService {
  // æ¨é€è³½äº‹è³‡è¨Š
  rpc PushMatchInfo (MatchInfoRequest) returns (ProcessResponse);
  
  // æ¨é€ç›¤å£è³ ç‡
  rpc PushMarketOdds (MarketOddsRequest) returns (ProcessResponse);
  
  // æ¨é€æ¯”è³½çµæœ
  rpc PushMatchResult (MatchResultRequest) returns (ProcessResponse);
  
  // ä¸²æµæ¨é€ (é«˜æ•ˆèƒ½)
  rpc StreamMatchInfo (stream MatchInfoRequest) returns (stream ProcessResponse);
  rpc StreamMarketOdds (stream MarketOddsRequest) returns (stream ProcessResponse);
}
```

### ç«¯å£è¨­å®š

| ç’°å¢ƒ | ç«¯å£ | å”å®š |
|------|------|------|
| Development | 5001 | HTTP/2 |
| Production | 5001 | HTTP/2 |

---

## ğŸ”§ è¨­å®š

### appsettings.json

```json
{
  "Grpc": {
    "Port": 5001
  },
  "Database": {
    "ConnectionString": "Server=localhost;Database=BigballGame;..."
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Grpc": "Information"
    }
  }
}
```

---

## ğŸ“‹ åˆ—èˆ‰èªªæ˜

### SportType (çƒç¨®é¡å‹)

| å€¼ | èªªæ˜ |
|----|------|
| Soccer = 1 | è¶³çƒ |
| Basketball = 2 | ç±ƒçƒ |
| Baseball = 3 | æ£’çƒ |
| IceHockey = 4 | å†°çƒ |
| AmericanFootball = 5 | ç¾å¼è¶³çƒ |
| Tennis = 6 | ç¶²çƒ |
| Esports = 7 | é›»ç«¶ |
| Volleyball = 8 | æ’çƒ |
| TableTennis = 9 | ä¹’ä¹“çƒ |
| Badminton = 10 | ç¾½æ¯›çƒ |

### MarketType (ç›¤å£é¡å‹)

| å€¼ | èªªæ˜ |
|----|------|
| Handicap = 1 | è®“çƒ |
| OverUnder = 2 | å¤§å° |
| MoneyLine = 3 | ç¨è´ |
| CorrectScore = 4 | æ³¢è†½ |
| HalfFullTime = 5 | åŠå…¨å ´ |
| OddEven = 6 | å–®é›™ |
| TotalGoals = 7 | ç¸½å¾—åˆ† |

### MatchStatus (æ¯”è³½ç‹€æ…‹)

| å€¼ | èªªæ˜ |
|----|------|
| NotStarted = 0 | æœªé–‹å§‹ |
| Live = 1 | é€²è¡Œä¸­ |
| Paused = 2 | æš«åœ |
| HalfTime = 3 | ä¸­å ´ä¼‘æ¯ |
| Ended = 4 | å·²çµæŸ |
| Cancelled = 5 | å–æ¶ˆ |
| Postponed = 6 | å»¶æœŸ |
| Interrupted = 7 | ä¸­æ–· |

---

## ğŸ—„ï¸ è³‡æ–™åº«è¨­å®š

### åŸ·è¡Œåˆå§‹åŒ–è…³æœ¬

```bash
sqlcmd -S localhost -d BigballGame -i sql/GS_Acqu_Database_Setup.sql
```

### æ–°å¢æ¬„ä½

| è³‡æ–™è¡¨ | æ¬„ä½ | èªªæ˜ |
|--------|------|------|
| `tblLeague` | `MapName_GS` | GS è¯è³½å°é»æ¬„ä½ |
| `tblTeam` | `TeamName_GS` | GS çƒéšŠå°é»æ¬„ä½ |

### æ²¿ç”¨ç¾æœ‰ç‰©ä»¶

| ç‰©ä»¶ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `GDetailType` | TVP | ç›¤å£æ‰¹æ¬¡æ›´æ–°é¡å‹ |
| `usp_ctl_UpdateDetail` | SP | ç›¤å£æ‰¹æ¬¡æ›´æ–°é å­˜ç¨‹åº |
| `usp_comm_InsertGameDetailLogByAcqu` | SP | ç›¤å£æ—¥èªŒè¨˜éŒ„ (å¯é¸) |

---

## ğŸš€ åŸ·è¡Œ

### é–‹ç™¼ç’°å¢ƒ

```bash
# é‚„åŸå¥—ä»¶
dotnet restore

# åŸ·è¡Œ Worker (gRPC æœå‹™)
cd src/GS.Acqu.Worker
dotnet run

# åŸ·è¡Œ API
cd src/GS.Acqu.Api
dotnet run
```

### ç™¼å¸ƒ

```bash
# ç™¼å¸ƒ Worker
dotnet publish src/GS.Acqu.Worker -c Release -o publish/worker

# ç™¼å¸ƒ API
dotnet publish src/GS.Acqu.Api -c Release -o publish/api
```

---

## ğŸ“¡ API ç«¯é»

### æœªå°é»è³½äº‹

| æ–¹æ³• | è·¯å¾‘ | èªªæ˜ |
|------|------|------|
| GET | `/api/unmatched` | å–å¾—æœªå°é»è³½äº‹æ¸…å–® |
| GET | `/api/unmatched/count` | å–å¾—æœªå°é»è³½äº‹æ•¸é‡ |
| DELETE | `/api/unmatched/{sourceMatchId}` | ç§»é™¤æœªå°é»è³½äº‹ |

### å°é»æœå‹™

| æ–¹æ³• | è·¯å¾‘ | èªªæ˜ |
|------|------|------|
| POST | `/api/matcher/refresh` | é‡æ–°è¼‰å…¥å°é»å¿«å– |

### å¥åº·æª¢æŸ¥

| æ–¹æ³• | è·¯å¾‘ | èªªæ˜ |
|------|------|------|
| GET | `/health` | æœå‹™å¥åº·ç‹€æ…‹ |

---

## ğŸ“ å°ˆæ¡ˆä¾è³´é—œä¿‚

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  GS.Acqu.Domain â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ GS.Acqu.Application â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ GS.Acqu.Infrastructure â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                 â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  GS.Acqu.Worker â”‚             â”‚   GS.Acqu.Api     â”‚
   â”‚    (gRPC)       â”‚             â”‚   (REST API)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å”¯ä¸€è­˜åˆ¥ç¢¼ç”Ÿæˆ (AcquUniqID)

ä½¿ç”¨ **BKDR Hash** æ¼”ç®—æ³•ç”¢ç”Ÿç›¤å£å”¯ä¸€è­˜åˆ¥ç¢¼ï¼š

```csharp
// çµ„åˆ Key æ ¼å¼
var key = $"{EvtID}_{MarketType}_{HalfType}_{Line}";
var acquUniqId = HashHelper.ToAcquUniqId(key);
```

### ç‰¹é»

- é€Ÿåº¦å¿«
- åˆ†å¸ƒå‡å‹»
- ç¢°æ’ç‡ä½
- èˆ‡ç¾æœ‰ç³»çµ±ä¸€è‡´

---

## â±ï¸ æ›´æ–°é »ç‡æ§åˆ¶

| ç›¤å£é¡å‹ | æ›´æ–°é–“éš” | èªªæ˜ |
|----------|----------|------|
| èµ°åœ°ç›¤å£ | 4 ç§’ | å³æ™‚æ€§è¦æ±‚é«˜ |
| ç‰¹æ®Šç©æ³• | 100 ç§’ | æ³¢è†½ç­‰è®Šå‹•é »ç‡ä½ |
| ä¸€èˆ¬ç›¤å£ | 10 ç§’ | å¹³è¡¡å³æ™‚æ€§èˆ‡æ•ˆèƒ½ |

---

## ğŸ›¡ï¸ ä¸¦ç™¼å®‰å…¨è¨­è¨ˆ

| æ©Ÿåˆ¶ | èªªæ˜ |
|------|------|
| **åŸå­æ€§å¿«å–æ›¿æ›** | å¿«å–åˆ·æ–°æ™‚å…ˆå»ºæ–° â†’ å†æ›¿æ›ï¼Œé¿å…è®€å–ç©ºå¿«å– |
| **TryAdd æª¢æŸ¥** | æ–°å¢å¿«å–å‰æª¢æŸ¥å›å‚³å€¼ï¼Œé¿å…é‡è¤‡å…¥éšŠ |
| **TryUpdate æª¢æŸ¥** | æ›´æ–°å¿«å–å‰æª¢æŸ¥å›å‚³å€¼ï¼Œé¿å…éæœŸè³‡æ–™è¦†è“‹ |
| **ConcurrentDictionary** | åŸ·è¡Œç·’å®‰å…¨çš„å¿«å–å®¹å™¨ |
| **ConcurrentQueue** | åŸ·è¡Œç·’å®‰å…¨çš„æ‰¹æ¬¡éšŠåˆ— |

---

## ğŸ“Š å°ˆæ¡ˆçµ±è¨ˆ

| æŒ‡æ¨™ | æ•¸é‡ |
|------|------|
| å°ˆæ¡ˆæ•¸ | 5 |
| å¯¦é«”é¡åˆ¥ | 9 |
| åˆ—èˆ‰ | 7 |
| ä»‹é¢ | 10 |
| æœå‹™å¯¦ä½œ | 6 |
| gRPC æ–¹æ³• | 5 |
| REST API | 5 |
